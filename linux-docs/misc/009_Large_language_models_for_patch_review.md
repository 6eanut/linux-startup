# Large language models for patch review

https://lwn.net/Articles/1041694/

# 用于补丁审查的大型语言模型

2025年10月16日 作者：乔纳森·科贝特（Jonathan Corbet）

自由软件社区中，关于大型语言模型（LLMs）在软件开发中的作用已有诸多讨论。不过，这些讨论大多聚焦于项目是否应接受这些模型生成的代码，以及在何种条件下接受。但这类系统还能以其他方式参与开发过程。克里斯·梅森（Chris Mason）近期在内核峰会讨论列表中发起了一场讨论，探讨如何利用这些模型进行补丁审查，而非生成代码。

梅森的核心关注点是，LLM如何通过在补丁提交至邮件列表前发现错误、帮助贡献者提升提交质量，从而减轻内核维护者的负担。为此，他整理了一套提示词，能生成符合维护者使用习惯的审查报告：“这些审查报告旨在模仿Linux内核邮件列表（lkml）上的邮件格式，即便内容大错特错，在格式上也完全达标。”他还附上了一长串示例审查报告，其中部分切中要点，部分则未能达到预期。

这些提示词本身颇具价值，可被视为一套全面的补丁审查文档——这类文档人类开发者始终未能彻底完成。或许这反映出人们对LLM会完整阅读所有材料抱有更高信心。这些提示词总计达数千行，开篇便是核心指导原则，例如：

- 结构体变更→验证所有使用者是否正确使用新结构体
- 公共API变更→验证文档是否同步更新[...]

## 语气要求

- 对话式：面向内核专家，而非初学者
- 事实性：避免煽情，仅提供技术层面的观察
- 提问方式：以关于代码的疑问呈现，而非指责

提示词的大部分内容是针对特定子系统的指导，例如锁机制（“目前你尚无法理解smp_mb()、smp_rmb()或smp_wmb()相关漏洞”）和网络模块（“套接字可能比其文件描述符存活更久”）。整体而言，这类似于20世纪80年代那些被认为将主宰世界的专家系统中的规则集合。正如README文件所指出的，“目前假阳性率相当高，约为50%”，因此仍有改进空间。

在后续讨论中，无人认为这种使用LLM的方式是个坏主意。萨沙·莱文（Sasha Levin）称其为“一个非常值得探讨的话题”，并表示在之前关于内核开发者使用LLM的讨论中，对LLM的担忧掩盖了寻找其实用场景的尝试。保罗·麦肯尼（Paul McKenney）表示，利用这项技术审查他人编写的代码“似乎比用它生成实际代码安全得多”。克日什托夫·科兹洛夫斯基（Krzysztof Kozlowski）提到，高通（Qualcomm）已开发出类似系统并对外开放。

有人对这些系统的专有属性表示担忧；康斯坦丁·里亚比采夫（Konstantin Ryabitsev）是众多将其与20多年前BitKeeper事件相提并论的人之一，该事件曾导致内核开发短暂停滞。洛朗·潘沙尔（Laurent Pinchart）明确表示，专有工具的使用和强制要求存在界限：
“强制贡献者为专有工具的使用权付费是不可接受的。强制贡献者运行专有工具同样不可接受。”

他还担忧，LLM背后的公司可能会先向开发者免费提供工具以推动 adoption，一旦社区深度依赖，访问权限可能会迅速变得昂贵。不过梅森并不担心锁定问题，他表示这些提示词足够通用，可适配任何系统。詹姆斯·博顿利（James Bottomley）认为LLM不会永远是专有技术，但潘沙尔反对为了等待最终可能出现的免费替代方案而依赖专有软件。

关于基于LLM的审查工具应面向谁开发，各方存在分歧。梅森的目标用户是维护者，但安德鲁·伦恩（Andrew Lunn）认为，方案应改为让开发者在提交代码审查前自行运行这些工具。他表示，这将进一步减轻维护者的工作量，维护者只需运行LLM审查以验证提交者是否已完成该步骤即可。

潘沙尔等人指出，让开发者使用现有的工具（如checkpatch.pl）已颇具难度；他质疑如何激励提交者运行任何新工具。蒂姆·伯德（Tim Bird）建议在补丁中添加已运行工具的列表标注，以便维护者查看相关记录。而博顿利则提出，这些工具应在补丁发送至邮件列表时自动运行，类似如今0day机器人对已提交补丁的检查机制。但伯德认为，运行这些工具应是提交者的责任。“这样一来，成本就转移到了贡献者身上，而非上游社区，这种模式的扩展性会更好。”

梅森明确表示，他认为LLM生成的审查报告应作为提交过程的一部分公开进行：
“我们还需记住，AI有时会大错特错。让审查报告出现在列表中，让更资深的开发者能够指出问题，无疑有助于避免浪费大家的时间。”

林纳斯·托瓦兹（Linus Torvalds）在讨论中仅发表了一次观点，但表示认同。他是唯一对这项技术表达担忧的人，称“我们都见过AI糟糕的一面，它有时会增加而非减少工作量”。梅森基于自身经验，也认同托瓦兹的担忧：
“我最初的提示词要求AI假设补丁存在漏洞，结果它总是凭空捏造漏洞。这虽然不算严重，但漏洞的解释总是极具说服力，会让你浪费大量时间去追查。”

托瓦兹还提到了数据爬取问题。尽管存在这些担忧，他仍认为这项技术将被证明是有用的，但他强调，初期应用必须以减轻维护者的日常工作负担为目标。“因此，我认为只有当AI工具真正能在日常工作流程中帮助到维护者时，才应该考虑让非维护者使用它们。”

此后，这场讨论逐渐平息。但一个明确的结论是，这些工具注定会在内核开发过程中扮演越来越重要的角色。未来，我们可能会开始在邮件列表中看到机器生成的审查报告；到那时，基于LLM的补丁审查工具的真正价值或许才会逐渐显现。值得关注的是，12月举行的2025年维护者峰会上，相关的讨论必将展开，其结果令人拭目以待。

| 本文索引条目 |                       |
| ------------ | --------------------- |
| 内核         | 开发工具/大型语言模型 |
